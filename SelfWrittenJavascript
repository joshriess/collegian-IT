'use strict';

const Alexa = require('alexa-sdk');

const languageStrings = {
    'en': {
        translation: {
            SKILL_NAME: 'Escape Hack K-State',
            WELCOME_MESSAGE: "Welcome to Escape Hack K-State",
            SELECTION_PROMPT: 'Select an option from the screen',
            STOP_MESSAGE: 'Goodbye!',
            HELP_MESSAGE: 'Try asking escape to select a number',
            HELP_REPROMPT: "Say something like, Select Option One",
            REPEAT_MESSAGE: "Sorry, I didn't get that."
        }
    }

}


const handlers = {
    'LaunchRequest': function () {
        this.attributes.speechOutput = this.t('WELCOME_MESSAGE', this.t('SELECTION_PROMPT'));
        this.attributes.repromptSpeech = this.t('SELECTION_PROMPT');

        this.response.speak(this.attributes.speechOutput).listen(this.attributes.repromptSpeech);
        this.emit(':responseReady');
    },

    'optionIntent': function () {
        const tempSelection = this.event.request.Intent.Slots.AMAZON.NUMBER;
        let speechOutput;
        let repromptSpeech;

        if(tempSelection) {
          let selection;
          selection = tempSelection.toLowerCase();
          speechOutput = selection;

        }
        else {
          let speechOutput = this.t('REPEAT_MESSAGE');
          speechOutput += this.t('HELP_MESSAGE');
          this.attributes.repromptSpeech = this.t('HELP_REPROMPT');
        }

        this.attributes.speechOutput = speechOutput;
        this.attributes.repromptSpeech = repromptSpeech;
        this.response.speak(speechOutput).listen(this.attributes.repromptSpeech);
        this.emit(':responseReady');
    },

    'Unhandled': function () {
      this.attributes.speechOutput = this.t('HELP_MESSAGE');
      this.attributes.repromptSpeech = this.t('HELP_REPROMPT');
      this.response.speak(this.attributes.speechOutput).listen(this.attributes.repromptSpeech);
      this.emit(':responseReady');
    }

}



exports.handler = (event, context, callback) => {
    // TODO implement
    //callback(null, 'Hello from Lambda');
    const alexa = Alexa.handler(event, context, callback);
    alexa.resources = languageStrings;
    alexa.registerHandlers(handlers);
    alexa.execute();
};
